# å¿ƒæƒ…éŸ³ä¹ç”Ÿæˆå™¨ - Android App (Flutter)

åŸºäºå¿ƒæƒ…ç”ŸæˆéŸ³ä¹çš„ Android åº”ç”¨ï¼Œä½¿ç”¨ Flutter å¼€å‘ï¼Œç›´æ¥è°ƒç”¨ MiniMax AI APIã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸµ **å¿ƒæƒ…è¾“å…¥**: ç”¨æˆ·æè¿°å½“å‰å¿ƒæƒ…æˆ–é€‰æ‹©å¿«æ·å¿ƒæƒ…é€‰é¡¹
- ğŸ¤– **AI åˆ†æ**: ä½¿ç”¨ MiniMax LLM åˆ†æå¿ƒæƒ…å¹¶ç”ŸæˆéŸ³ä¹é£æ ¼å’Œæ­Œè¯
- ğŸ¼ **éŸ³ä¹ç”Ÿæˆ**: è°ƒç”¨ MiniMax Music API ç”Ÿæˆå®šåˆ¶éŸ³ä¹
- ğŸ§ **éŸ³é¢‘æ’­æ”¾**: å†…ç½®éŸ³é¢‘æ’­æ”¾å™¨ï¼Œæ”¯æŒæ’­æ”¾/æš‚åœã€è¿›åº¦æ§åˆ¶
- ğŸ“± **åˆ†äº«åŠŸèƒ½**: æ”¯æŒå°†ç”Ÿæˆçš„éŸ³ä¹åˆ†äº«åˆ°å…¶ä»–åº”ç”¨
- ğŸ’¾ **æœ¬åœ°å­˜å‚¨**: ç”Ÿæˆçš„éŸ³ä¹æ–‡ä»¶ä¿å­˜åœ¨æœ¬åœ°

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Flutter 3.0+
- **è¯­è¨€**: Dart 3.0+
- **AI æœåŠ¡**:
  - MiniMax LLM API (MiniMax-Text-01)
  - MiniMax Music API (music-2.0)
- **ä¸»è¦ä¾èµ–**:
  - `http` / `dio` - HTTP å®¢æˆ·ç«¯
  - `audioplayers` - éŸ³é¢‘æ’­æ”¾
  - `share_plus` - åˆ†äº«åŠŸèƒ½
  - `path_provider` - æ–‡ä»¶è·¯å¾„ç®¡ç†
  - `flutter_secure_storage` - å®‰å…¨å­˜å‚¨ API Key

## é¡¹ç›®ç»“æ„

```
mood_music_app/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ main.dart                    # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ models/                      # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ music_response.dart      # éŸ³ä¹å“åº”æ¨¡å‹
â”‚   â”‚   â””â”€â”€ generation_state.dart    # ç”ŸæˆçŠ¶æ€æ¨¡å‹
â”‚   â”œâ”€â”€ services/                    # æœåŠ¡å±‚
â”‚   â”‚   â””â”€â”€ minimax_service.dart     # MiniMax API é›†æˆ
â”‚   â”œâ”€â”€ screens/                     # é¡µé¢
â”‚   â”‚   â””â”€â”€ home_screen.dart         # ä¸»é¡µé¢
â”‚   â””â”€â”€ widgets/                     # UI ç»„ä»¶
â”‚       â”œâ”€â”€ mood_input_section.dart  # å¿ƒæƒ…è¾“å…¥åŒºåŸŸ
â”‚       â”œâ”€â”€ progress_section.dart    # è¿›åº¦æ˜¾ç¤º
â”‚       â””â”€â”€ result_section.dart      # ç»“æœå±•ç¤ºï¼ˆæ’­æ”¾å™¨+åˆ†äº«ï¼‰
â”œâ”€â”€ android/                         # Android åŸç”Ÿé…ç½®
â”œâ”€â”€ assets/                          # èµ„æºæ–‡ä»¶
â”œâ”€â”€ pubspec.yaml                     # é¡¹ç›®é…ç½®å’Œä¾èµ–
â””â”€â”€ README.md                        # æœ¬æ–‡æ¡£
```

## ç¯å¢ƒè¦æ±‚

### å¼€å‘ç¯å¢ƒ

- Flutter SDK >= 3.0.0
- Dart SDK >= 3.0.0
- Android Studio / VS Code
- Android SDK (API Level 21+)

### è¿è¡Œç¯å¢ƒ

- Android 5.0 (API Level 21) æˆ–æ›´é«˜ç‰ˆæœ¬

## å®‰è£…ä¸è¿è¡Œ

### 1. å®‰è£… Flutter

å‚è€ƒ [Flutter å®˜æ–¹æ–‡æ¡£](https://flutter.dev/docs/get-started/install) å®‰è£… Flutter SDKã€‚

### 2. éªŒè¯ Flutter ç¯å¢ƒ

```bash
flutter doctor
```

ç¡®ä¿æ‰€æœ‰å¿…éœ€çš„ä¾èµ–éƒ½å·²å®‰è£…ã€‚

### 3. è·å–ä¾èµ–

```bash
cd mood_music_app
flutter pub get
```

### 4. è¿è¡Œåº”ç”¨

#### åœ¨æ¨¡æ‹Ÿå™¨/çœŸæœºä¸Šè¿è¡Œ

```bash
# æŸ¥çœ‹å¯ç”¨è®¾å¤‡
flutter devices

# è¿è¡Œåº”ç”¨
flutter run
```

#### æ„å»º APK

```bash
# Debug APK
flutter build apk --debug

# Release APK
flutter build apk --release

# Split APK (æŒ‰ ABI åˆ†å‰²ï¼Œå‡å°ä½“ç§¯)
flutter build apk --split-per-abi
```

ç”Ÿæˆçš„ APK æ–‡ä»¶ä½äº `build/app/outputs/flutter-apk/`

### 5. å®‰è£… APK åˆ°è®¾å¤‡

```bash
# ä½¿ç”¨ adb å®‰è£…
adb install build/app/outputs/flutter-apk/app-release.apk
```

## API é…ç½®

åº”ç”¨è¿è¡Œæ—¶éœ€è¦ç”¨æˆ·è¾“å…¥ MiniMax API Keyã€‚

### è·å– API Key

1. è®¿é—® [MiniMax å¼€æ”¾å¹³å°](https://api.minimaxi.com)
2. æ³¨å†Œ/ç™»å½•è´¦å·
3. åœ¨æ§åˆ¶å°åˆ›å»ºåº”ç”¨å¹¶è·å– API Key

### åœ¨åº”ç”¨ä¸­ä½¿ç”¨

1. æ‰“å¼€åº”ç”¨
2. åœ¨ "ğŸ”‘ MiniMax API Key" è¾“å…¥æ¡†ä¸­è¾“å…¥ä½ çš„ API Key
3. è¾“å…¥å¿ƒæƒ…æè¿°
4. ç‚¹å‡» "ğŸµ ç”Ÿæˆæˆ‘çš„éŸ³ä¹"

**æ³¨æ„**: API Key ä»…åœ¨å†…å­˜ä¸­ä¿å­˜ï¼Œä¸ä¼šæŒä¹…åŒ–å­˜å‚¨ã€‚é‡æ–°æ‰“å¼€åº”ç”¨éœ€è¦å†æ¬¡è¾“å…¥ã€‚

å¦‚éœ€æŒä¹…åŒ–å­˜å‚¨ API Keyï¼Œå¯ä»¥ä½¿ç”¨ `flutter_secure_storage` åŒ…ï¼ˆå·²åŒ…å«åœ¨ä¾èµ–ä¸­ï¼‰ã€‚

## ä½¿ç”¨è¯´æ˜

### åŸºæœ¬æµç¨‹

1. **è¾“å…¥ API Key**: åœ¨é¡¶éƒ¨è¾“å…¥æ¡†è¾“å…¥ MiniMax API Key
2. **æè¿°å¿ƒæƒ…**:
   - æ–¹å¼1: åœ¨æ–‡æœ¬æ¡†ä¸­è‡ªç”±æè¿°ä½ çš„å¿ƒæƒ…
   - æ–¹å¼2: ç‚¹å‡»å¿«æ·å¿ƒæƒ…æŒ‰é’®ï¼ˆå¼€å¿ƒã€éš¾è¿‡ã€å¹³é™ç­‰ï¼‰
3. **ç”ŸæˆéŸ³ä¹**: ç‚¹å‡» "ç”Ÿæˆæˆ‘çš„éŸ³ä¹" æŒ‰é’®
4. **ç­‰å¾…ç”Ÿæˆ**: æŸ¥çœ‹è¿›åº¦æ¡å’Œæ­¥éª¤æŒ‡ç¤ºå™¨
   - æ­¥éª¤1: åˆ†æå¿ƒæƒ…
   - æ­¥éª¤2: åˆ›ä½œæ­Œè¯
   - æ­¥éª¤3: ç”ŸæˆéŸ³ä¹
   - æ­¥éª¤4: å¤„ç†éŸ³é¢‘
5. **æ’­æ”¾/åˆ†äº«**:
   - ç‚¹å‡»æ’­æ”¾æŒ‰é’®æ’­æ”¾éŸ³ä¹
   - æ‹–åŠ¨è¿›åº¦æ¡è·³è½¬
   - ç‚¹å‡» "åˆ†äº«" æŒ‰é’®åˆ†äº«åˆ°å…¶ä»–åº”ç”¨
   - ç‚¹å‡» "é‡æ–°ç”Ÿæˆ" åˆ›ä½œæ–°çš„éŸ³ä¹

### å¿«æ·å¿ƒæƒ…

åº”ç”¨å†…ç½®ä»¥ä¸‹å¿«æ·å¿ƒæƒ…é€‰é¡¹ï¼š
- å¼€å¿ƒ
- éš¾è¿‡
- å¹³é™
- å…´å¥‹
- ç„¦è™‘
- æ”¾æ¾
- æ€€å¿µ
- å­¤ç‹¬

## API è¯´æ˜

### MiniMax LLM API

- **ç«¯ç‚¹**: `https://api.minimaxi.com/v1/text/chatcompletion_v2`
- **æ¨¡å‹**: `MiniMax-Text-01`
- **ç”¨é€”**: æ ¹æ®ç”¨æˆ·å¿ƒæƒ…ç”ŸæˆéŸ³ä¹é£æ ¼æè¿°å’Œæ­Œè¯
- **å‚æ•°**:
  - `max_tokens`: 4096
  - `temperature`: 0.7

### MiniMax Music API

- **ç«¯ç‚¹**: `https://api.minimaxi.com/v1/music_generation`
- **æ¨¡å‹**: `music-2.0`
- **ç”¨é€”**: æ ¹æ®æç¤ºè¯å’Œæ­Œè¯ç”ŸæˆéŸ³ä¹
- **éŸ³é¢‘è®¾ç½®**:
  - `sample_rate`: 44100 Hz
  - `bitrate`: 256 kbps
  - `format`: MP3

## å¼€å‘æŒ‡å—

### ç›®å½•è¯´æ˜

- **models/**: æ•°æ®æ¨¡å‹ç±»
  - `MusicResponse`: éŸ³ä¹ç”Ÿæˆå“åº”
  - `GenerationState`: ç”Ÿæˆè¿›åº¦çŠ¶æ€

- **services/**: ä¸šåŠ¡é€»è¾‘å±‚
  - `MinimaxService`: MiniMax API è°ƒç”¨å°è£…

- **screens/**: é¡µé¢ç»„ä»¶
  - `HomeScreen`: ä¸»é¡µé¢ï¼Œç®¡ç†æ•´ä½“çŠ¶æ€

- **widgets/**: UI ç»„ä»¶
  - `MoodInputSection`: å¿ƒæƒ…è¾“å…¥å’Œ API Key è¾“å…¥
  - `ProgressSection`: è¿›åº¦æ˜¾ç¤º
  - `ResultSection`: ç»“æœå±•ç¤ºï¼ˆæ’­æ”¾å™¨+åˆ†äº«ï¼‰

### è‡ªå®šä¹‰å¼€å‘

#### ä¿®æ”¹å¿«æ·å¿ƒæƒ…é€‰é¡¹

ç¼–è¾‘ `lib/screens/home_screen.dart`:

```dart
final List<String> _quickMoods = [
  'å¼€å¿ƒ',
  'éš¾è¿‡',
  // æ·»åŠ æ›´å¤šå¿ƒæƒ…...
];
```

#### ä¿®æ”¹éŸ³ä¹ç”Ÿæˆå‚æ•°

ç¼–è¾‘ `lib/services/minimax_service.dart`:

```dart
'audio_setting': {
  'sample_rate': 44100,  // é‡‡æ ·ç‡
  'bitrate': 256000,     // æ¯”ç‰¹ç‡
  'format': 'mp3',       // æ ¼å¼
}
```

#### ä¿®æ”¹ LLM æç¤ºè¯

ç¼–è¾‘ `lib/services/minimax_service.dart` ä¸­çš„ `generatePromptAndLyrics` æ–¹æ³•ã€‚

### æ·»åŠ æ–°åŠŸèƒ½

#### 1. æŒä¹…åŒ– API Key

ä½¿ç”¨ `flutter_secure_storage`:

```dart
import 'package:flutter_secure_storage/flutter_secure_storage.dart';

final storage = FlutterSecureStorage();

// ä¿å­˜
await storage.write(key: 'api_key', value: apiKey);

// è¯»å–
String? apiKey = await storage.read(key: 'api_key');
```

#### 2. å†å²è®°å½•

å¯ä»¥ä½¿ç”¨ `sqflite` æˆ– `hive` ä¿å­˜ç”Ÿæˆå†å²ã€‚

## å¸¸è§é—®é¢˜

### Q1: åº”ç”¨é—ªé€€æˆ–æ— æ³•è¿è¡Œï¼Ÿ

- æ£€æŸ¥ Flutter ç‰ˆæœ¬: `flutter --version`
- è¿è¡Œ `flutter doctor` æ£€æŸ¥ç¯å¢ƒ
- æ¸…ç†é¡¹ç›®: `flutter clean && flutter pub get`

### Q2: ç”ŸæˆéŸ³ä¹å¤±è´¥ï¼Ÿ

- æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®
- ç¡®ä¿æœ‰ç½‘ç»œè¿æ¥
- æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼ˆåº”ç”¨ä¼šæ˜¾ç¤ºå…·ä½“é”™è¯¯ï¼‰
- æ£€æŸ¥ MiniMax API ä½™é¢

### Q3: éŸ³é¢‘æ— æ³•æ’­æ”¾ï¼Ÿ

- æ£€æŸ¥è®¾å¤‡éŸ³é‡
- ç¡®è®¤éŸ³é¢‘æ–‡ä»¶å·²æˆåŠŸä¿å­˜
- æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—

### Q4: åˆ†äº«åŠŸèƒ½ä¸å·¥ä½œï¼Ÿ

- ç¡®ä¿è®¾å¤‡ä¸Šå®‰è£…äº†å¯ä»¥æ¥æ”¶åˆ†äº«çš„åº”ç”¨
- æ£€æŸ¥æ–‡ä»¶æƒé™
- Android 11+ éœ€è¦é…ç½® `AndroidManifest.xml`

## æ€§èƒ½ä¼˜åŒ–

- ç”Ÿæˆçš„éŸ³é¢‘æ–‡ä»¶ä¼šä¿å­˜åœ¨åº”ç”¨æ–‡æ¡£ç›®å½•
- å»ºè®®å®šæœŸæ¸…ç†æ—§çš„éŸ³é¢‘æ–‡ä»¶ä»¥èŠ‚çœç©ºé—´
- å¯ä»¥åœ¨ `MinimaxService` ä¸­æ·»åŠ æ–‡ä»¶æ¸…ç†é€»è¾‘

## è®¸å¯è¯

æœ¬é¡¹ç›®ä¸ Web ç‰ˆæœ¬å…±ç”¨åŒä¸€ä»“åº“ï¼Œéµå¾ªé¡¹ç›®æ ¹ç›®å½•çš„è®¸å¯è¯ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è®¿é—®é¡¹ç›® GitHub ä»“åº“æäº¤ Issueã€‚

---

**æ³¨æ„**:
- æœ¬åº”ç”¨ç›´æ¥ä»å®¢æˆ·ç«¯è°ƒç”¨ MiniMax APIï¼Œè¯·å¦¥å–„ä¿ç®¡ä½ çš„ API Key
- API è°ƒç”¨å¯èƒ½äº§ç”Ÿè´¹ç”¨ï¼Œè¯·å‚è€ƒ MiniMax è®¡è´¹è¯´æ˜
- å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é€šè¿‡åç«¯æœåŠ¡å™¨è°ƒç”¨ APIï¼Œé¿å…æš´éœ² API Key

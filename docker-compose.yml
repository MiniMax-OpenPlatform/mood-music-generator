services:
  mood-music-web:
    image: mood-music-generator:latest
    container_name: mood-music-generator
    ports:
      - "5111:5111"
    environment:
      - PORT=5111
      - http_proxy=http://pac-internal.xaminim.com:3129
      - https_proxy=http://pac-internal.xaminim.com:3129
      - no_proxy=localhost,127.0.0.1
    volumes:
      # 持久化临时音频文件（如果使用 hex 模式）
      - ./temp_sessions:/app/temp_sessions
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:5111/moodmusic/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - mood-music-network

networks:
  mood-music-network:
    driver: bridge
